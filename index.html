<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>My Godot Web Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preload" href="/game/godot.wasm" as="fetch" type="application/wasm" crossorigin>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>

    <main class="container menu-page war" aria-labelledby="gameTitle">
        <!-- ambient decor (sparks/embers) -->
        <div class="decor" aria-hidden="true">
            <span class="paw" style="--i:0; --x:8%; --d:0s"></span>
            <span class="paw" style="--i:1; --x:22%; --d:.6s"></span>
            <span class="paw" style="--i:2; --x:40%; --d:1.2s"></span>
            <span class="paw" style="--i:3; --x:58%; --d:1.8s"></span>
            <span class="paw" style="--i:4; --x:76%; --d:2.4s"></span>
            <span class="paw" style="--i:5; --x:90%; --d:3s"></span>
        </div>

        <section class="menu-card battle focused" role="region" aria-label="Game menu">
            <header class="hero">
                <div class="logo" aria-hidden="true">
                    <!-- Tactical shield + crosshair doghouse badge -->
                    <svg viewBox="0 0 220 160" width="168" height="122" role="img" aria-label="Doghouse tactical badge">
                        <defs>
                            <linearGradient id="steel" x1="0" y1="0" x2="0" y2="1">
                                <stop offset="0" stop-color="#9aa3ad"/>
                                <stop offset="1" stop-color="#444b53"/>
                            </linearGradient>
                            <linearGradient id="danger" x1="0" y1="0" x2="1" y2="1">
                                <stop offset="0" stop-color="#ef4444"/>
                                <stop offset="1" stop-color="#f59e0b"/>
                            </linearGradient>
                        </defs>
                        <g stroke="url(#danger)" stroke-width="4" opacity=".8">
                            <circle cx="110" cy="80" r="58" fill="none"/>
                            <path d="M20 80h60M110 20v60M140 80h60M110 110v30" />
                        </g>
                        <path d="M110 20 L170 46 L170 102 Q140 128 110 140 Q80 128 50 102 L50 46 Z"
                              fill="url(#steel)" stroke="#0b0f14" stroke-width="3"/>
                        <g transform="translate(110,86)">
                            <polygon points="-45,-12 0,-42 45,-12 35,-12 35,35 -35,35 -35,-12"
                                     fill="#0f1720" stroke="#0b0f14" stroke-width="3"/>
                            <path d="M0,-2 a18,18 0 0 0 -18,18 v19 h36 v-19 a18,18 0 0 0 -18,-18z" fill="#ef4444"/>
                        </g>
                    </svg>
                </div>

                <div class="titles">
                    <h1 id="gameTitle" class="title-glow">DOGHOUSE: TOWER DEFENCE</h1>
                    <p class="tagline mission">Operation CATSHIELD ‚Ä¢ Hold the line ‚Ä¢ No cat left behind</p>
                </div>
            </header>

            <nav class="menu" role="menu" aria-label="Main menu">
                <button id="startBtn" class="btn lg accent tactical" role="menuitem" autofocus>
                    <span class="btn-icon" aria-hidden="true">üéØ</span>
                    Start Mission
                </button>

                <button id="optionsBtn" class="btn ghost outline tactical" role="menuitem" aria-haspopup="dialog" aria-controls="optionsDialog">
                    <span class="btn-icon" aria-hidden="true">‚öôÔ∏è</span>
                    Loadout
                </button>
                <button id="battlefieldBtn" class="btn ghost outline tactical" role="menuitem" aria-haspopup="dialog" aria-controls="battlefieldDialog">
                    <span class="btn-icon" aria-hidden="true">üó∫Ô∏è</span>
                    Battlefield
                </button>

                <button id="quitBtn" class="btn ghost outline tactical" role="menuitem">
                    <span class="btn-icon" aria-hidden="true">‚èª</span>
                    Stand Down
                </button>
            </nav>

            <div class="meta">
                <!-- Removed Last Save; keeping only Best Wave -->
                <div class="pill dogtag">BEST WAVE <span id="bestWave">0</span></div>
            </div>

            <p class="footnote intel">
                Tip: You cannot completely block the path from the enemies!
            </p>
        </section>

        <!-- existing dialog kept intact -->
        <dialog id="optionsDialog">
            <form method="dialog" class="dialog-content">
                <h2>Loadout</h2>
                <label class="row">
                    <span>Mute audio</span>
                    <input type="checkbox" id="optMute">
                </label>
                <label class="row">
                    <span>Start in fullscreen</span>
                    <input type="checkbox" id="optFullscreen" checked>
                </label>
                <label class="row">
                    <span>Override grid size</span>
                    <input type="checkbox" id="optGridOverride">
                </label>
                <label class="row">
                    <span>Grid size</span>
                    <select id="optGridSize" disabled>
                        <option value="large">large ‚Äì 36√ó24</option>
                        <option value="medium" selected>medium ‚Äì 30√ó20</option>
                        <option value="small">small ‚Äì 24√ó16</option>
                    </select>
                </label>
                <label class="row">
                    <span>Difficulty</span>
                    <select id="optDifficulty">
                        <option value="easy">easy</option>
                        <option value="medium" selected>medium</option>
                        <option value="hard">hard</option>
                        <option value="free">free mode</option>
                    </select>
                </label>
                <menu class="dialog-actions">
                    <button value="cancel" class="btn ghost">Cancel</button>
                    <button id="saveOptions" value="default" class="btn tactical">Save</button>
                </menu>
            </form>
        </dialog>
        <dialog id="battlefieldDialog">
            <form method="dialog" class="dialog-content">
                <h2>Select Battlefield</h2>
                <div id="battlefieldOptions" class="maps">
                    <label class="map-choice">
                        <input type="radio" name="battlefield" value="backyard" checked>
                        <img src="./assets/maps/backyard/backyard.png" alt="Backyard map preview">
                        <span>Backyard ‚Äì Medium (30√ó20)</span>
                    </label>
                </div>
                <menu class="dialog-actions">
                    <button value="cancel" class="btn ghost">Cancel</button>
                    <button id="saveBattlefield" value="default" class="btn tactical">Save</button>
                </menu>
            </form>
        </dialog>
    </main>
<canvas id="gameCanvas"></canvas>

<div id="statsOverlay" class="stats-overlay">
  <div class="overlay-header">
    <button id="nextWaveBtn" class="btn sm tactical">Next Wave</button>
    <button id="quitGameBtn" class="btn sm tactical ghost">Quit Game</button>
  </div>
  <div id="overlayStats" class="overlay-stats"></div>
</div>

<div id="hoverMenu" class="hover-menu">
  <div id="hoverMenuHeader" class="menu-header">
    <span class="header-title">Command Center</span>
    <div class="header-indicator"></div>
  </div>
  
  <div class="tab-navigation">
    <button class="tab-btn active" data-tab="build">
      <span class="tab-icon">üî®</span>
      <span class="tab-label">Build</span>
    </button>
    <button class="tab-btn" data-tab="upgrade">
      <span class="tab-icon">‚ö°</span>
      <span class="tab-label">Upgrade</span>
    </button>
    <button class="tab-btn" data-tab="stats">
      <span class="tab-icon">üìä</span>
      <span class="tab-label">Stats</span>
    </button>
    <button class="tab-btn" data-tab="options">
      <span class="tab-icon">‚öôÔ∏è</span>
      <span class="tab-label">Options</span>
    </button>
  </div>

  <div class="tab-container">
    <div id="tab-build" class="tab-content active">
      <div class="tab-header">
        <h3>Build Towers</h3>
        <div class="tab-subtitle">Select a tower to build</div>
      </div>
      <div id="buildList" class="build-list"></div>
      <div class="build-actions">
        <button id="sellBuildBtn" class="btn sm ghost tactical" title="Sell Mode">
          <span class="btn-icon">üí∞</span>
          Sell
        </button>
        <button id="cancelBuildBtn" class="btn sm ghost tactical" title="Cancel Build">
          <span class="btn-icon">‚ùå</span>
          Cancel
        </button>
      </div>
    </div>

    <div id="tab-upgrade" class="tab-content">
      <div class="tab-header">
        <h3>Tower Upgrades</h3>
        <div class="tab-subtitle">Enhance your selected tower</div>
      </div>
      
      <div id="selectedTowerInfo" class="tower-info">
        <div class="no-selection">No tower selected</div>
      </div>
      
      <div id="upgradeOptions" class="upgrade-container">
        <div id="basicUpgrades" class="upgrade-section">
          <h4 class="section-title">Basic Upgrades</h4>
          <div class="upgrade-grid">
            <div class="upgrade-item">
              <div class="upgrade-header">
                <span class="upgrade-label">Damage</span>
                <span class="upgrade-icon">‚öîÔ∏è</span>
              </div>
              <div class="upgrade-details">
                <span id="damageValue" class="current-value">-</span>
                <span id="damageNext" class="next-value">(+0)</span>
              </div>
              <div class="upgrade-footer">
                <span id="damageCost" class="upgrade-cost">$0</span>
                <button id="upgradeDamage" class="btn sm upgrade-btn">+</button>
              </div>
            </div>

            <div class="upgrade-item">
              <div class="upgrade-header">
                <span class="upgrade-label">Speed</span>
                <span class="upgrade-icon">‚ö°</span>
              </div>
              <div class="upgrade-details">
                <span id="fireRateValue" class="current-value">-</span>
                <span id="fireRateNext" class="next-value">(+0)</span>
              </div>
              <div class="upgrade-footer">
                <span id="fireRateCost" class="upgrade-cost">$0</span>
                <button id="upgradeFireRate" class="btn sm upgrade-btn">+</button>
              </div>
            </div>

            <div class="upgrade-item">
              <div class="upgrade-header">
                <span class="upgrade-label">Range</span>
                <span class="upgrade-icon">üéØ</span>
              </div>
              <div class="upgrade-details">
                <span id="rangeValue" class="current-value">-</span>
                <span id="rangeNext" class="next-value">(+0)</span>
              </div>
              <div class="upgrade-footer">
                <span id="rangeCost" class="upgrade-cost">$0</span>
                <button id="upgradeRange" class="btn sm upgrade-btn">+</button>
              </div>
            </div>
          </div>
        </div>

        <div id="specialUpgrades" class="upgrade-section" style="display:none;">
          <h4 class="section-title">Special Variants</h4>
          <div class="special-upgrade-grid">
            <div class="special-upgrade-item">
              <div class="special-header">
                <span class="special-icon">üéØ</span>
                <span class="special-name">Sniper</span>
              </div>
              <span id="sniperCost" class="special-cost"></span>
              <button id="upgradeSniper" class="btn sm special-btn">Select</button>
            </div>

            <div class="special-upgrade-item">
              <div class="special-header">
                <span class="special-icon">üî´</span>
                <span class="special-name">Shotgun</span>
              </div>
              <span id="shotgunCost" class="special-cost"></span>
              <button id="upgradeShotgun" class="btn sm special-btn">Select</button>
            </div>

            <div class="special-upgrade-item">
              <div class="special-header">
                <span class="special-icon">üî¥</span>
                <span class="special-name">Dual Laser</span>
              </div>
              <span id="dualLaserCost" class="special-cost"></span>
              <button id="upgradeDualLaser" class="btn sm special-btn">Select</button>
            </div>

            <div class="special-upgrade-item">
              <div class="special-header">
                <span class="special-icon">‚ö°</span>
                <span class="special-name">Railgun</span>
              </div>
              <span id="railgunCost" class="special-cost"></span>
              <button id="upgradeRailgun" class="btn sm special-btn">Select</button>
            </div>

            <div class="special-upgrade-item">
              <div class="special-header">
                <span class="special-icon">üí•</span>
                <span class="special-name">Nuke</span>
              </div>
              <span id="nukeCost" class="special-cost"></span>
              <button id="upgradeNuke" class="btn sm special-btn">Select</button>
            </div>

            <div class="special-upgrade-item">
              <div class="special-header">
                <span class="special-icon">üî•</span>
                <span class="special-name">Hellfire</span>
              </div>
              <span id="hellfireCost" class="special-cost"></span>
              <button id="upgradeHellfire" class="btn sm special-btn">Select</button>
            </div>
          </div>
        </div>
      </div>
      
      <div class="tower-actions">
        <button id="sellTower" class="btn tactical sell-btn">
          <span class="btn-icon">üí∞</span>
          Sell Tower
        </button>
      </div>
    </div>

    <div id="tab-stats" class="tab-content">
      <div class="tab-header">
        <h3>Battle Statistics</h3>
        <div class="tab-subtitle">Current game performance</div>
      </div>
      <div id="gameStats" class="stats-display"></div>
    </div>

    <div id="tab-options" class="tab-content">
      <div class="tab-header">
        <h3>Game Options</h3>
        <div class="tab-subtitle">Control your game session</div>
      </div>
      <div class="options-list">
        <button id="pauseBtn" class="btn tactical full-width">
          <span class="btn-icon">‚è∏Ô∏è</span>
          Pause Game
        </button>
        <button id="quitInMenuBtn" class="btn tactical ghost full-width">
          <span class="btn-icon">üö™</span>
          Quit to Menu
        </button>
      </div>
    </div>
  </div>
</div>

<div id="contextMenu" class="context-menu">
  <div class="context-header">Tower Info</div>
  <div id="contextStats" class="context-stats"></div>
  <div class="context-actions">
    <button id="contextSell" class="btn sm tactical">
      <span class="btn-icon">üí∞</span>
      Sell
    </button>
  </div>
</div>

  <script src="./main.js" defer></script>
</body>
</html>
